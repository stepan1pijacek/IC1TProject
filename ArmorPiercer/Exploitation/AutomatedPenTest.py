from Utilities.ProcessActions import CreateProcess as cp
import re
import subprocess as sp
import click


class AutomatedPenTest:
    def __init__(self, process_path, bank_account):
        self.process_path = process_path
        self.bank_account = bank_account

    def begin_pen_test(self):
        process = sp.Popen([self.process_path], stdout=sp.PIPE, stdin=sp.PIPE)
        current_console_out = process.stdout.readline()

        if not re.match("password|login", current_console_out.decode("utf-8")):
            click.echo()
            return "Failed, application did not start"

        process.stdin.writelines("aaaaaaaaaaaaaaaaaaaaaaaaaaa")

        current_console_out = process.stdout.readline()

        if not re.match("account number", current_console_out.decode("utf-8")):
            return "Failed."

        process.stdin.writelines("1231354")

        current_console_out = process.stdout.readline()

        if not re.match("amount", current_console_out.decode("utf-8")):
            return "Failed."

        process.stdin.writelines("2147651143")

        process.kill()
        print("Penetration testing terminated with success")
